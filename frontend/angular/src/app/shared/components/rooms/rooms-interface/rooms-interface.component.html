<div class="w-full h-full pt-4 md:pt-8 lg:pt-12">
  <div class="flex flex-col h-full relative font-sans bg-gray-50 rounded-lg md:rounded-xl shadow-md md:shadow-lg p-3 md:p-5 overflow-hidden">
    
    <!-- Controles del mapa con Tailwind -->
    <div class="absolute bottom-3 sm:bottom-4 md:bottom-6 left-3 sm:left-4 md:left-6 flex gap-1 sm:gap-2 z-10 backdrop-blur-md bg-white/80 p-1 sm:p-1.5 rounded-lg shadow-md">
      <button class="bg-white border border-gray-200 rounded-md w-8 h-8 sm:w-9 sm:h-9 flex items-center justify-center cursor-pointer shadow-sm transition-all hover:bg-gray-50 hover:shadow hover:-translate-y-0.5 text-gray-600" (click)="zoom(1.1, 400, 300)">
        <i class="fa-solid fa-plus text-sm"></i>
      </button>
      <button class="bg-white border border-gray-200 rounded-md w-8 h-8 sm:w-9 sm:h-9 flex items-center justify-center cursor-pointer shadow-sm transition-all hover:bg-gray-50 hover:shadow hover:-translate-y-0.5 text-gray-600" (click)="zoom(0.9, 400, 300)">
        <i class="fa-solid fa-minus text-sm"></i>
      </button>
      <button class="bg-white border border-gray-200 rounded-md px-2 sm:px-3 h-8 sm:h-9 flex items-center justify-center cursor-pointer shadow-sm transition-all hover:bg-gray-50 hover:shadow hover:-translate-y-0.5 text-gray-600 text-xs sm:text-sm font-medium" (click)="resetView()">
        <i class="fa-solid fa-arrows-to-dot me-1.5"></i> Vista Completa
      </button>
    </div>
    
    <!-- Contenedor del mapa con Tailwind -->
    <div class="flex-1 overflow-hidden relative bg-white border border-gray-200 rounded-lg shadow-sm mb-3 md:mb-5 transition-all hover:shadow-md">
      <svg #mapSvg width="100%" height="100%" viewBox="0 0 1000 500" preserveAspectRatio="xMidYMid meet" class="min-h-[300px] sm:min-h-[400px] md:min-h-[500px] cursor-grab active:cursor-grabbing" (click)="onMapBackgroundClick()">
        <!-- Definiciones de gradientes para los tipos de habitaciones -->
        <defs>
          <pattern id="pattern-grid" width="50" height="50" patternUnits="userSpaceOnUse">
            <path d="M 50 0 L 0 0 0 50" fill="none" stroke="#f1f5f9" stroke-width="0.5"/>
            <path d="M 10 0 L 10 50 M 20 0 L 20 50 M 30 0 L 30 50 M 40 0 L 40 50" fill="none" stroke="#f8fafc" stroke-width="0.3"/>
            <path d="M 0 10 L 50 10 M 0 20 L 50 20 M 0 30 L 50 30 M 0 40 L 50 40" fill="none" stroke="#f8fafc" stroke-width="0.3"/>
          </pattern>
          
          <linearGradient id="gradient-room" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="#ffedd5" />
            <stop offset="100%" stop-color="#fed7aa" />
          </linearGradient>
          
          <linearGradient id="gradient-common" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="#f3e8ff" />
            <stop offset="100%" stop-color="#e9d5ff" />
          </linearGradient>
          
          <linearGradient id="gradient-kitchen" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="#e0f2fe" />
            <stop offset="100%" stop-color="#bae6fd" />
          </linearGradient>
          
          <linearGradient id="gradient-bath" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="#dbeafe" />
            <stop offset="100%" stop-color="#93c5fd" />
          </linearGradient>
          
          <linearGradient id="gradient-laundry" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="#fef3c7" />
            <stop offset="100%" stop-color="#fde68a" />
          </linearGradient>
          
          <linearGradient id="gradient-dining" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="#dcfce7" />
            <stop offset="100%" stop-color="#bbf7d0" />
          </linearGradient>

          <!-- Marcador de flecha para la rosa de vientos -->
          <marker id="arrowhead" markerWidth="6" markerHeight="6" refX="0" refY="3" orient="auto">
            <polygon points="0 0, 6 3, 0 6" fill="#3b82f6" />
          </marker>
          
          <!-- Marcador para cotas -->
          <marker id="markerStart" markerWidth="4" markerHeight="4" refX="2" refY="2">
            <circle cx="2" cy="2" r="2" fill="#64748b" />
          </marker>
          <marker id="markerEnd" markerWidth="4" markerHeight="4" refX="2" refY="2">
            <circle cx="2" cy="2" r="2" fill="#64748b" />
          </marker>
        </defs>
        
        <g class="map-content">
          <!-- Fondo del mapa con patrón de cuadrícula -->
          <rect width="1000" height="500" fill="white"></rect>
          <rect width="1000" height="500" fill="url(#pattern-grid)"></rect>
          
          <!-- Marco del edificio -->
          <rect x="50" y="50" width="900" height="400" fill="white" stroke="#64748b" stroke-width="3"></rect>
          
          <!-- Pasillos horizontales -->
          <rect x="60" y="160" width="880" height="30" fill="#f8fafc" stroke="#cbd5e1" stroke-width="1"></rect>
          <rect x="60" y="310" width="880" height="30" fill="#f8fafc" stroke="#cbd5e1" stroke-width="1"></rect>
          
          <!-- Pasillo vertical -->
          <rect x="500" y="190" width="30" height="120" fill="#f8fafc" stroke="#cbd5e1" stroke-width="1"></rect>
          
          <!-- HABITACIONES GENERADAS DINÁMICAMENTE -->
          <ng-container *ngFor="let room of rooms">
            <!-- Rectángulo de la habitación -->
            <rect 
              [attr.id]="room.id" 
              [attr.x]="getRoomCoords(room).x"
              [attr.y]="getRoomCoords(room).y"
              [attr.width]="getRoomCoords(room).width"
              [attr.height]="getRoomCoords(room).height"
              [attr.fill]="getRoomFill(room.id)"
              [attr.stroke]="getRoomStroke(room.id)"
              stroke-width="1.5"
              class="transition-all duration-300 cursor-pointer hover:stroke-[2.5px] hover:opacity-95"
              (click)="openDetailsModal(room)">
            </rect>
            
            <!-- Puertas para las habitaciones superiores -->
            <line 
              *ngIf="room.id.startsWith('h1') || room.id === 'commonRoom' || room.id === 'bathNorth'" 
              [attr.x1]="getRoomCenter(room).x"
              [attr.y1]="getRoomCoords(room).y + getRoomCoords(room).height" 
              [attr.x2]="getRoomCenter(room).x"
              [attr.y2]="getRoomCoords(room).y + getRoomCoords(room).height + 10" 
              stroke="#475569" 
              stroke-width="2">
            </line>
            
            <!-- Puertas para las habitaciones inferiores -->
            <line 
              *ngIf="room.id.startsWith('h2') || room.id === 'laundry' || room.id === 'bathSouth'" 
              [attr.x1]="getRoomCenter(room).x"
              [attr.y1]="getRoomCoords(room).y" 
              [attr.x2]="getRoomCenter(room).x"
              [attr.y2]="getRoomCoords(room).y - 10" 
              stroke="#475569" 
              stroke-width="2">
            </line>
            
            <!-- Puertas para comedor -->
            <line 
              *ngIf="room.id === 'dining'" 
              [attr.x1]="getRoomCoords(room).x + getRoomCoords(room).width" 
              [attr.y1]="getRoomCenter(room).y"
              [attr.x2]="getRoomCoords(room).x + getRoomCoords(room).width + 10"
              [attr.y2]="getRoomCenter(room).y" 
              stroke="#475569" 
              stroke-width="2">
            </line>
            
            <!-- Puertas para cocina -->
            <line 
              *ngIf="room.id === 'kitchen'" 
              [attr.x1]="getRoomCoords(room).x" 
              [attr.y1]="getRoomCenter(room).y"
              [attr.x2]="getRoomCoords(room).x - 10"
              [attr.y2]="getRoomCenter(room).y" 
              stroke="#475569" 
              stroke-width="2">
            </line>
            
            <!-- Etiquetas y medidas -->
            <text 
              [attr.x]="getRoomCenter(room).x"
              [attr.y]="room.id.includes('bath') || room.id === 'laundry' ? getRoomCenter(room).y - 5 : getRoomCenter(room).y + 5"
              text-anchor="middle" 
              class="text-sm font-semibold select-none pointer-events-none"
              fill="#374151">
              {{room.name}}
            </text>
            
            <!-- Dimensiones de la habitación -->
            <text 
              [attr.x]="getRoomCenter(room).x"
              [attr.y]="getRoomCenter(room).y + 25"
              text-anchor="middle" 
              class="text-[10px] fill-gray-500 select-none pointer-events-none">
              {{getRoomCoords(room).width / 10}}m × {{getRoomCoords(room).height / 10}}m
            </text>
            
            <!-- Iconos de FontAwesome para las habitaciones -->
            <g class="room-icon" 
              [attr.transform]="'translate(' + getRoomCenter(room).x + ',' + (room.id.includes('bath') || room.id === 'laundry' ? getRoomCenter(room).y - 25 : getRoomCenter(room).y - 15) + ')'">
              <!-- Círculo de fondo para el icono -->
              <circle r="12" fill="white" stroke="#e2e8f0" stroke-width="1"></circle>
              
              <!-- Iconos según tipo de habitación usando texto Unicode -->
              <text text-anchor="middle" dominant-baseline="middle" class="select-none pointer-events-none" font-size="12" fill="#64748b">
                <tspan *ngIf="room.id.startsWith('h')">
                  <tspan font-family="'Font Awesome 6 Free'" font-weight="900">&#xf236;</tspan>
                </tspan>
                <tspan *ngIf="room.id === 'commonRoom'">
                  <tspan font-family="'Font Awesome 6 Free'" font-weight="900">&#xf4b8;</tspan>
                </tspan>
                <tspan *ngIf="room.id === 'kitchen'">
                  <tspan font-family="'Font Awesome 6 Free'" font-weight="900">&#xf2e7;</tspan>
                </tspan>
                <tspan *ngIf="room.id === 'dining'">
                  <tspan font-family="'Font Awesome 6 Free'" font-weight="900">&#xf2e7;</tspan>
                </tspan>
                <tspan *ngIf="room.id.includes('bath')">
                  <tspan font-family="'Font Awesome 6 Free'" font-weight="900">&#xf2cc;</tspan>
                </tspan>
                <tspan *ngIf="room.id === 'laundry'">
                  <tspan font-family="'Font Awesome 6 Free'" font-weight="900">&#xf21e;</tspan>
                </tspan>
              </text>
            </g>
            
            <!-- Ventanas para habitaciones exteriores -->
            <line 
              *ngIf="getRoomCoords(room).x === 60" 
              [attr.x1]="getRoomCoords(room).x"
              [attr.y1]="getRoomCenter(room).y - 20"
              [attr.x2]="getRoomCoords(room).x"
              [attr.y2]="getRoomCenter(room).y + 20"
              stroke="#a1a1aa" 
              stroke-width="3">
            </line>
            
            <line 
              *ngIf="getRoomCoords(room).x + getRoomCoords(room).width >= 940" 
              [attr.x1]="getRoomCoords(room).x + getRoomCoords(room).width"
              [attr.y1]="getRoomCenter(room).y - 20"
              [attr.x2]="getRoomCoords(room).x + getRoomCoords(room).width"
              [attr.y2]="getRoomCenter(room).y + 20"
              stroke="#a1a1aa" 
              stroke-width="3">
            </line>
            
            <line 
              *ngIf="getRoomCoords(room).y === 60" 
              [attr.x1]="getRoomCenter(room).x - 20"
              [attr.y1]="getRoomCoords(room).y"
              [attr.x2]="getRoomCenter(room).x + 20"
              [attr.y2]="getRoomCoords(room).y"
              stroke="#a1a1aa" 
              stroke-width="3">
            </line>
          </ng-container>
          
          <!-- Entrada principal con puerta -->
          <rect x="10" y="160" width="40" height="30" fill="#bfdbfe" stroke="#3b82f6" stroke-width="2"></rect>
          <path d="M 50,160 A 30,30 0 0 1 50,190" fill="none" stroke="#3b82f6" stroke-width="2"></path>
          <text x="30" y="180" text-anchor="middle" class="text-xs font-semibold" fill="#1e40af">ENTRADA</text>
          
          <!-- Título del plano y datos profesionales -->
          <g transform="translate(20, 20)">
            <text class="text-xl font-bold" fill="#1f2937">RESIDENCIA ESTUDIANTIL - PLANTA 1</text>
            <text y="25" class="text-sm" fill="#4b5563">PROYECTO: RST-2023-45 | FECHA: NOVIEMBRE 2023</text>
            <text y="45" class="text-sm" fill="#4b5563">ESCALA 1:100 | UNIDADES: METROS</text>
          </g>
          
          <!-- Rosa de los vientos más profesional -->
          <g transform="translate(950, 50)">
            <!-- Círculo exterior -->
            <circle cx="0" cy="0" r="25" fill="white" stroke="#94a3b8" stroke-width="1"></circle>
            <!-- Círculo interior -->
            <circle cx="0" cy="0" r="20" fill="white" stroke="#94a3b8" stroke-width="0.5"></circle>
            
            <!-- Líneas principales -->
            <line x1="0" y1="-25" x2="0" y2="25" stroke="#64748b" stroke-width="0.5"></line>
            <line x1="-25" y1="0" x2="25" y2="0" stroke="#64748b" stroke-width="0.5"></line>
            
            <!-- Flecha norte -->
            <path d="M0,0 L0,-18" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrowhead)"></path>
            
            <!-- Textos de orientación -->
            <text x="0" y="-10" text-anchor="middle" class="text-xs font-bold" fill="#1e3a8a">N</text>
            <text x="0" y="15" text-anchor="middle" class="text-xs font-bold" fill="#64748b">S</text>
            <text x="-10" y="4" text-anchor="middle" class="text-xs font-bold" fill="#64748b">O</text>
            <text x="10" y="4" text-anchor="middle" class="text-xs font-bold" fill="#64748b">E</text>
          </g>
          
          <!-- Cotas y líneas de dimensión horizontales -->
          <g class="dimension-lines">
            <!-- Cota horizontal superior -->
            <line x1="50" y1="30" x2="950" y2="30" stroke="#64748b" stroke-width="1" stroke-dasharray="5,3" marker-start="url(#markerStart)" marker-end="url(#markerEnd)"></line>
            <line x1="50" y1="25" x2="50" y2="35" stroke="#64748b" stroke-width="1"></line>
            <line x1="950" y1="25" x2="950" y2="35" stroke="#64748b" stroke-width="1"></line>
            <text x="500" y="25" text-anchor="middle" class="text-xs" fill="#64748b">90.0 m</text>
            
            <!-- Cota horizontal pasillos -->
            <line x1="50" y1="175" x2="950" y2="175" stroke="#64748b" stroke-width="1" stroke-dasharray="5,3"></line>
            <text x="30" y="175" text-anchor="end" class="text-xs" fill="#64748b">+0.00</text>
            
            <!-- Cota vertical izquierda -->
            <line x1="30" y1="50" x2="30" y2="450" stroke="#64748b" stroke-width="1" stroke-dasharray="5,3" marker-start="url(#markerStart)" marker-end="url(#markerEnd)"></line>
            <line x1="25" y1="50" x2="35" y2="50" stroke="#64748b" stroke-width="1"></line>
            <line x1="25" y1="450" x2="35" y2="450" stroke="#64748b" stroke-width="1"></line>
            <text x="20" y="250" transform="rotate(270, 20, 250)" text-anchor="middle" class="text-xs" fill="#64748b">40.0 m</text>
          </g>
          
          <!-- Escala gráfica -->
          <g transform="translate(850, 460)">
            <rect x="0" y="0" width="100" height="2" fill="#64748b"></rect>
            <rect x="0" y="0" width="50" height="2" fill="#1e3a8a"></rect>
            <line x1="0" y1="0" x2="0" y2="6" stroke="#64748b" stroke-width="1"></line>
            <line x1="50" y1="0" x2="50" y2="6" stroke="#64748b" stroke-width="1"></line>
            <line x1="100" y1="0" x2="100" y2="6" stroke="#64748b" stroke-width="1"></line>
            <text x="0" y="15" text-anchor="middle" class="text-[10px]" fill="#64748b">0</text>
            <text x="50" y="15" text-anchor="middle" class="text-[10px]" fill="#64748b">5m</text>
            <text x="100" y="15" text-anchor="middle" class="text-[10px]" fill="#64748b">10m</text>
          </g>
        </g>
      </svg>
    </div>
  </div>
</div>