<div class="w-full h-full pt-4 md:pt-8 lg:pt-12">
  <div class="flex flex-col h-full relative font-sans bg-gray-50 rounded-lg md:rounded-xl shadow-md md:shadow-lg p-3 md:p-5 overflow-hidden">
    
    <!-- Controles del mapa mejorados -->
    <div class="absolute bottom-3 sm:bottom-4 md:bottom-6 left-3 sm:left-4 md:left-6 flex gap-2 sm:gap-3 z-10 backdrop-blur-md bg-white/90 p-2 sm:p-2.5 rounded-lg shadow-lg border border-gray-100">
      <button class="bg-white border border-gray-200 rounded-md w-9 h-9 sm:w-10 sm:h-10 flex items-center justify-center cursor-pointer shadow-sm transition-all hover:bg-gray-50 hover:shadow-md hover:-translate-y-0.5 text-gray-600" (click)="zoom(1.1, 400, 300)">
        <i class="fa-solid fa-plus text-sm"></i>
      </button>
      <button class="bg-white border border-gray-200 rounded-md w-9 h-9 sm:w-10 sm:h-10 flex items-center justify-center cursor-pointer shadow-sm transition-all hover:bg-gray-50 hover:shadow-md hover:-translate-y-0.5 text-gray-600" (click)="zoom(0.9, 400, 300)">
        <i class="fa-solid fa-minus text-sm"></i>
      </button>
      <button class="bg-white border border-gray-200 rounded-md px-3 sm:px-4 h-9 sm:h-10 flex items-center justify-center cursor-pointer shadow-sm transition-all hover:bg-gray-50 hover:shadow-md hover:-translate-y-0.5 text-gray-600 text-xs sm:text-sm font-medium" (click)="resetView()">
        <i class="fa-solid fa-arrows-to-dot me-2.5"></i> Vista Completa
      </button>
    </div>
    
    <!-- Contenedor del mapa mejorado -->
    <div class="flex-1 overflow-hidden relative bg-white border border-gray-200 rounded-lg shadow-sm mb-3 md:mb-5 transition-all hover:shadow-md">
      <svg #mapSvg width="100%" height="100%" viewBox="0 0 1000 500" preserveAspectRatio="xMidYMid meet" class="min-h-[300px] sm:min-h-[400px] md:min-h-[500px] cursor-grab active:cursor-grabbing" (click)="onMapBackgroundClick()">
        <!-- Definiciones de gradientes mejorados -->
        <defs>
          <pattern id="pattern-grid" width="50" height="50" patternUnits="userSpaceOnUse">
            <path d="M 50 0 L 0 0 0 50" fill="none" stroke="#f1f5f9" stroke-width="0.5"/>
            <path d="M 10 0 L 10 50 M 20 0 L 20 50 M 30 0 L 30 50 M 40 0 L 40 50" fill="none" stroke="#f8fafc" stroke-width="0.3"/>
            <path d="M 0 10 L 50 10 M 0 20 L 50 20 M 0 30 L 50 30 M 0 40 L 50 40" fill="none" stroke="#f8fafc" stroke-width="0.3"/>
          </pattern>
          
          <!-- Gradientes mejorados con colores más vibrantes -->
          <linearGradient id="gradient-room" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="#fff7ed" />
            <stop offset="100%" stop-color="#ffedd5" />
          </linearGradient>
          
          <linearGradient id="gradient-common" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="#f9f5ff" />
            <stop offset="100%" stop-color="#f3e8ff" />
          </linearGradient>
          
          <linearGradient id="gradient-kitchen" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="#ecfeff" />
            <stop offset="100%" stop-color="#e0f2fe" />
          </linearGradient>
          
          <linearGradient id="gradient-bath" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="#eff6ff" />
            <stop offset="100%" stop-color="#dbeafe" />
          </linearGradient>
          
          <linearGradient id="gradient-laundry" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="#fffbeb" />
            <stop offset="100%" stop-color="#fef3c7" />
          </linearGradient>
          
          <linearGradient id="gradient-dining" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="#f0fdf4" />
            <stop offset="100%" stop-color="#dcfce7" />
          </linearGradient>
          
          <!-- Nuevos gradientes para las habitaciones adicionales -->
          <linearGradient id="gradient-reception" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="#fdf2f8" />
            <stop offset="100%" stop-color="#fbcfe8" />
          </linearGradient>
          
          <linearGradient id="gradient-office" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="#eff6ff" />
            <stop offset="100%" stop-color="#bfdbfe" />
          </linearGradient>
          
          <linearGradient id="gradient-gym" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="#fffbeb" />
            <stop offset="100%" stop-color="#fcd34d" />
          </linearGradient>
          
          <linearGradient id="gradient-multiroom" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="#f5f3ff" />
            <stop offset="100%" stop-color="#ddd6fe" />
          </linearGradient>

          <!-- Marcadores para la rosa de vientos -->
          <marker id="arrowhead" markerWidth="6" markerHeight="6" refX="0" refY="3" orient="auto">
            <polygon points="0 0, 6 3, 0 6" fill="#3b82f6" />
          </marker>
          
          <!-- Filtros para sombras elegantes -->
          <filter id="dropShadow" x="-20%" y="-20%" width="140%" height="140%">
            <feDropShadow dx="2" dy="2" stdDeviation="2" flood-color="#64748b" flood-opacity="0.2"/>
          </filter>
        </defs>
        
        <g class="map-content">
          <!-- Fondo del mapa con patrón de cuadrícula -->
          <rect width="1000" height="500" fill="white"></rect>
          <rect width="1000" height="500" fill="url(#pattern-grid)"></rect>
          
          <!-- Marco del edificio con sombra elegante -->
          <rect x="50" y="50" width="900" height="400" fill="white" stroke="#64748b" stroke-width="2.5" filter="url(#dropShadow)" rx="4" ry="4"></rect>
          
          <!-- Pasillos horizontales -->
          <rect x="60" y="160" width="880" height="30" fill="#f8fafc" stroke="#cbd5e1" stroke-width="1" rx="2" ry="2"></rect>
          <rect x="60" y="310" width="880" height="30" fill="#f8fafc" stroke="#cbd5e1" stroke-width="1" rx="2" ry="2"></rect>
          
          <!-- Pasillo vertical -->
          <rect x="500" y="190" width="30" height="120" fill="#f8fafc" stroke="#cbd5e1" stroke-width="1" rx="2" ry="2"></rect>
          
          <!-- HABITACIONES GENERADAS DINÁMICAMENTE con efectos mejorados -->
          <ng-container *ngFor="let room of rooms">
            <!-- Rectángulo de la habitación con efectos mejorados -->
            <rect 
              [attr.id]="room.id" 
              [attr.x]="getRoomCoords(room).x"
              [attr.y]="getRoomCoords(room).y"
              [attr.width]="getRoomCoords(room).width"
              [attr.height]="getRoomCoords(room).height"
              [attr.fill]="getRoomFill(room.id)"
              [attr.stroke]="getRoomStroke(room.id)"
              stroke-width="1.5"
              rx="3" ry="3"
              class="transition-all duration-300 cursor-pointer hover:stroke-[3px] hover:opacity-95"
              filter="drop-shadow(0px 1px 2px rgba(0,0,0,0.06))"
              (click)="openDetailsModal(room)">
            </rect>
            
            <!-- Puertas para las habitaciones con mejor estilo -->
            <line 
              *ngIf="room.id.startsWith('h1') || room.id === 'commonRoom' || room.id === 'bathNorth'" 
              [attr.x1]="getRoomCenter(room).x - 12"
              [attr.y1]="getRoomCoords(room).y + getRoomCoords(room).height" 
              [attr.x2]="getRoomCenter(room).x + 12"
              [attr.y2]="getRoomCoords(room).y + getRoomCoords(room).height" 
              stroke="#475569" 
              stroke-width="2">
            </line>
            
            <line 
              *ngIf="room.id.startsWith('h2') || room.id === 'laundry' || room.id === 'bathSouth'" 
              [attr.x1]="getRoomCenter(room).x - 12"
              [attr.y1]="getRoomCoords(room).y" 
              [attr.x2]="getRoomCenter(room).x + 12"
              [attr.y2]="getRoomCoords(room).y" 
              stroke="#475569" 
              stroke-width="2">
            </line>
            
            <line 
              *ngIf="room.id === 'dining'" 
              [attr.x1]="getRoomCoords(room).x + getRoomCoords(room).width" 
              [attr.y1]="getRoomCenter(room).y - 12"
              [attr.x2]="getRoomCoords(room).x + getRoomCoords(room).width"
              [attr.y2]="getRoomCenter(room).y + 12" 
              stroke="#475569" 
              stroke-width="2">
            </line>
            
            <line 
              *ngIf="room.id === 'kitchen'" 
              [attr.x1]="getRoomCoords(room).x" 
              [attr.y1]="getRoomCenter(room).y - 12"
              [attr.x2]="getRoomCoords(room).x"
              [attr.y2]="getRoomCenter(room).y + 12" 
              stroke="#475569" 
              stroke-width="2">
            </line>
            
            <!-- Puertas para las nuevas habitaciones -->
            <line 
              *ngIf="room.id === 'reception' || room.id === 'office'" 
              [attr.x1]="getRoomCenter(room).x - 12"
              [attr.y1]="getRoomCoords(room).y + getRoomCoords(room).height" 
              [attr.x2]="getRoomCenter(room).x + 12"
              [attr.y2]="getRoomCoords(room).y + getRoomCoords(room).height" 
              stroke="#475569" 
              stroke-width="2">
            </line>
            
            <line 
              *ngIf="room.id === 'gym' || room.id === 'multiroom'" 
              [attr.x1]="getRoomCenter(room).x - 12"
              [attr.y1]="getRoomCoords(room).y" 
              [attr.x2]="getRoomCenter(room).x + 12"
              [attr.y2]="getRoomCoords(room).y" 
              stroke="#475569" 
              stroke-width="2">
            </line>
            
            <!-- Nombre de habitación con mejor posicionamiento y espaciado -->
            <text 
              [attr.x]="getRoomCenter(room).x"
              [attr.y]="(room.id === 'reception' || room.id === 'office' || room.id === 'gym' || room.id === 'multiroom') ? 
                getRoomCenter(room).y + 8 : 
                (room.id.includes('bath') || room.id === 'laundry' ? 
                  getRoomCenter(room).y + 10 : getRoomCenter(room).y + 24)"
              text-anchor="middle" 
              class="text-sm font-semibold select-none pointer-events-none"
              fill="#374151">
              {{room.name}}
            </text>
            
            <!-- Iconos de FontAwesome con mejor posición y estilo -->
            <g class="room-icon" 
              [attr.transform]="'translate(' + getRoomCenter(room).x + ',' + 
              (room.id === 'reception' || room.id === 'office' || room.id === 'gym' || room.id === 'multiroom' ? 
                getRoomCenter(room).y - 15 : 
                (room.id.includes('bath') || room.id === 'laundry' ? 
                  getRoomCenter(room).y - 30 : getRoomCenter(room).y - 20)) + ')'">
              
              <!-- Círculo de fondo para el icono mejorado -->
              <circle r="16" fill="white" stroke="#e2e8f0" stroke-width="1" filter="url(#dropShadow)"></circle>
              
              <!-- Iconos según tipo de habitación usando texto Unicode -->
              <text text-anchor="middle" dominant-baseline="middle" class="select-none pointer-events-none" font-size="14" fill="#475569">
                <tspan *ngIf="room.id.startsWith('h')">
                  <tspan font-family="'Font Awesome 6 Free'" font-weight="900">&#xf236;</tspan>
                </tspan>
                <tspan *ngIf="room.id === 'commonRoom'">
                  <tspan font-family="'Font Awesome 6 Free'" font-weight="900">&#xf4b8;</tspan>
                </tspan>
                <tspan *ngIf="room.id === 'kitchen'">
                  <tspan font-family="'Font Awesome 6 Free'" font-weight="900">&#xf2e7;</tspan>
                </tspan>
                <tspan *ngIf="room.id === 'dining'">
                  <tspan font-family="'Font Awesome 6 Free'" font-weight="900">&#xf2e7;</tspan>
                </tspan>
                <tspan *ngIf="room.id.includes('bath')">
                  <tspan font-family="'Font Awesome 6 Free'" font-weight="900">&#xf2cc;</tspan>
                </tspan>
                <tspan *ngIf="room.id === 'laundry'">
                  <tspan font-family="'Font Awesome 6 Free'" font-weight="900">&#xf21e;</tspan>
                </tspan>
                <!-- Iconos para las nuevas habitaciones -->
                <tspan *ngIf="room.id === 'reception'">
                  <tspan font-family="'Font Awesome 6 Free'" font-weight="900">&#xf64a;</tspan>
                </tspan>
                <tspan *ngIf="room.id === 'office'">
                  <tspan font-family="'Font Awesome 6 Free'" font-weight="900">&#xf0b1;</tspan>
                </tspan>
                <tspan *ngIf="room.id === 'gym'">
                  <tspan font-family="'Font Awesome 6 Free'" font-weight="900">&#xf44b;</tspan>
                </tspan>
                <tspan *ngIf="room.id === 'multiroom'">
                  <tspan font-family="'Font Awesome 6 Free'" font-weight="900">&#xf500;</tspan>
                </tspan>
              </text>
            </g>
            
            <!-- Ventanas para habitaciones exteriores con estilo mejorado -->
            <line 
              *ngIf="getRoomCoords(room).x === 60" 
              [attr.x1]="getRoomCoords(room).x"
              [attr.y1]="getRoomCenter(room).y - 25"
              [attr.x2]="getRoomCoords(room).x"
              [attr.y2]="getRoomCenter(room).y + 25"
              stroke="#a1a1aa" 
              stroke-width="4"
              stroke-linecap="round">
            </line>
            
            <line 
              *ngIf="getRoomCoords(room).x + getRoomCoords(room).width >= 940" 
              [attr.x1]="getRoomCoords(room).x + getRoomCoords(room).width"
              [attr.y1]="getRoomCenter(room).y - 25"
              [attr.x2]="getRoomCoords(room).x + getRoomCoords(room).width"
              [attr.y2]="getRoomCenter(room).y + 25"
              stroke="#a1a1aa" 
              stroke-width="4"
              stroke-linecap="round">
            </line>
            
            <line 
              *ngIf="getRoomCoords(room).y === 60" 
              [attr.x1]="getRoomCenter(room).x - 25"
              [attr.y1]="getRoomCoords(room).y"
              [attr.x2]="getRoomCenter(room).x + 25"
              [attr.y2]="getRoomCoords(room).y"
              stroke="#a1a1aa" 
              stroke-width="4"
              stroke-linecap="round">
            </line>
          </ng-container>
          
          <!-- Entrada principal con puerta mejorada -->
          <rect x="10" y="160" width="40" height="30" fill="#bfdbfe" stroke="#3b82f6" stroke-width="2" rx="3" ry="3" filter="url(#dropShadow)"></rect>
          <path d="M 50,160 A 30,30 0 0 1 50,190" fill="none" stroke="#3b82f6" stroke-width="2"></path>
          <text x="30" y="178" text-anchor="middle" class="text-xs font-bold" fill="#1e40af">ENTRADA</text>
          
          <!-- Título del plano con mejor espaciado -->
          <g transform="translate(20, 20)">
            <text class="text-xl font-bold" fill="#1f2937">RESIDENCIA ESTUDIANTIL - PLANTA 1</text>
            <text y="25" class="text-sm" fill="#64748b">PROYECTO: RST-2023-45 | FECHA: NOVIEMBRE 2023</text>
          </g>
          
          <!-- Rosa de los vientos mejorada -->
          <g transform="translate(950, 50)">
            <!-- Círculo exterior -->
            <circle cx="0" cy="0" r="28" fill="white" stroke="#94a3b8" stroke-width="1" filter="url(#dropShadow)"></circle>
            <!-- Círculo interior -->
            <circle cx="0" cy="0" r="22" fill="white" stroke="#94a3b8" stroke-width="0.5"></circle>
            
            <!-- Líneas principales -->
            <line x1="0" y1="-22" x2="0" y2="22" stroke="#94a3b8" stroke-width="0.5"></line>
            <line x1="-22" y1="0" x2="22" y2="0" stroke="#94a3b8" stroke-width="0.5"></line>
            
            <!-- Flecha norte -->
            <path d="M0,0 L0,-18" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrowhead)"></path>
            
            <!-- Textos de orientación con mejor espaciado -->
            <text x="0" y="-12" text-anchor="middle" class="text-xs font-bold" fill="#1e3a8a">N</text>
            <text x="0" y="15" text-anchor="middle" class="text-xs font-bold" fill="#64748b">S</text>
            <text x="-12" y="4" text-anchor="middle" class="text-xs font-bold" fill="#64748b">O</text>
            <text x="12" y="4" text-anchor="middle" class="text-xs font-bold" fill="#64748b">E</text>
          </g>
        </g>
      </svg>
    </div>
  </div>
</div>